<!DOCTYPE html>
<html>

<head>
    <title>Sampple</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Vue development version, includes helpful console warnings -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- Axios library -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- Load required Bootstrap and BootstrapVue CSS -->
    <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css"/>

    <!-- Load polyfills to support older browsers -->
    <script src="//polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"
            crossorigin="anonymous"></script>

    <!-- Load Vue followed by BootstrapVue -->
    <script src="//unpkg.com/vue@latest/dist/vue.min.js"></script>
    <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

    <!-- Load the following for BootstrapVueIcons support -->
    <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue-icons.min.js"></script>
</head>

<body class="bg-info">
<div id="app">
    <table class="table">
        <thead>
        <tr>
            <th scope="col">Model</th>
            <th scope="col">Preview</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="phone in phones">
            <td> {{phone.model}} </td>
            <td> {{phone.url_image}} </td>
            <td> <button>Compare</button> </td>
        </tr>
        </tbody>
    </table>
<!--    <div>Page Number: {{pageNumber}}</div>-->
</div>
<script>

    var app = new Vue({
        el: '#app',
        data: {
            phones: [],
            pages: [],
            search: '',
            totalPhones: ''
        },
        methods: {
            //Get all the phones from the web service using Axios.
            loadProducts: function () {
                var localApp = this;
                var url = window.location.href;
                const queries = new URLSearchParams(url);
                const numItems = 5;
                const offset = queries.get('offset');

                    axios.get('/phones?num_items=' + numItems + "&offset=" + offset)//Send GET request to phones path
                        .then(function (response) {//Request successful
                            localApp.pageNumber =  '' + ((offset / 5) + 1);
                            //Point phones in data to returned array of phones
                            localApp.phones = response.data.phones;
                            console.log(JSON.stringify(response.data.phones));
                        })
                        .catch(function (error) {
                            //Handle error
                            console.log(error);
                        });
            },
            loadPageNumbers() {
                var localApp = this;
                axios.get('/totalNumberOfPhones') //Send GET request to get all products
                    .then(function (response) {//Request successful
                        localApp.totalPhones = response.data.pageNumbers;
                        console.log("PARSED: " + parseInt(localApp.totalPhones));
                        console.log("PAGE NUMBERS: " +  localApp.totalPhones);
                        //Point phones in data to returned array of phones
                        localApp.phones = response.data.phones;
                        console.log(JSON.stringify(localApp.totalPhones));
                    })
                    .catch(function (error) {
                        //Handle error
                        console.log(error);
                    });
            },
            goToComparePage(item) {
                window.location.href += "product.html?model=" + item.model;
            }
        },
        created: function () {//Vue lifecycle hook, called when data is loaded.
            //Load products from web service
            this.loadProducts();
            this.loadPageNumbers();

            //Refresh products every 5 seconds
            setInterval(this.loadProducts, 5000);
        }
    })

</script>
<script src="./client.js"/>
</body>

</html>